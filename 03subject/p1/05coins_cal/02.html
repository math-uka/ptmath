<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¡¬å¹£è¨ˆç®—éŠæˆ² | Coin Calculation Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* é–ƒçˆå‹•ç•« | Blinking Animation */
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        .blink {
            animation: blink 1s infinite;
            display: inline-block;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-between">
    <!-- é›£åº¦é¸æ“‡ç•«é¢ | Difficulty Selection Screen -->
    <div id="difficulty-screen" class="flex flex-col items-center justify-center h-full">
        <h1 class="text-3xl font-bold mb-8">é¸æ“‡é›£åº¦ | Select Difficulty</h1>
        <div class="flex space-x-4">
            <button id="easy-btn" class="px-6 py-3 bg-green-500 text-white rounded hover:bg-green-600 text-xl">ç°¡å–® | Easy</button>
            <button id="normal-btn" class="px-6 py-3 bg-blue-500 text-white rounded hover:bg-blue-600 text-xl">æ™®é€š | Normal</button>
            <button id="hard-btn" class="px-6 py-3 bg-red-500 text-white rounded hover:bg-red-600 text-xl">å›°é›£ | Hard</button>
        </div>
    </div>
    <!-- éŠæˆ²ä¸»ç•«é¢ | Main Game Screen -->
    <div id="game-screen" class="hidden flex flex-col items-center justify-between w-full min-h-screen">
        <!-- é ‚éƒ¨é¡¯ç¤ºæ˜Ÿæ˜Ÿ | Top Star Display -->
        <div class="my-2 text-2xl font-bold flex items-center">
            <span>æ˜Ÿæ˜Ÿæ•¸ | Star Count:</span>
            <div id="star-count" class="flex ml-2"></div>
        </div>
        <!-- ä¸­å¤®è¼¸å…¥å€åŸŸ | Central Input Area -->
        <div class="my-2 text-4xl font-bold">
            è¼¸å…¥é‡‘é¡ | Input Amount: <span id="input-amount">ï¼Ÿ åœ“ ï¼Ÿ æ¯« | ? Patacas ? Avos</span>
        </div>
        <!-- æ•¸å­—éµç›¤ | Number Keypad -->
        <div class="mb-4 grid grid-cols-3 gap-2 w-64">
            <button class="num-btn px-4 py-4 bg-gray-200 rounded hover:bg-gray-300 text-xl">1</button>
            <button class="num-btn px-4 py-4 bg-gray-200 rounded hover:bg-gray-300 text-xl">2</button>
            <button class="num-btn px-4 py-4 bg-gray-200 rounded hover:bg-gray-300 text-xl">3</button>
            <button class="num-btn px-4 py-4 bg-gray-200 rounded hover:bg-gray-300 text-xl">4</button>
            <button class="num-btn px-4 py-4 bg-gray-200 rounded hover:bg-gray-300 text-xl">5</button>
            <button class="num-btn px-4 py-4 bg-gray-200 rounded hover:bg-gray-300 text-xl">6</button>
            <button class="num-btn px-4 py-4 bg-gray-200 rounded hover:bg-gray-300 text-xl">7</button>
            <button class="num-btn px-4 py-4 bg-gray-200 rounded hover:bg-gray-300 text-xl">8</button>
            <button class="num-btn px-4 py-4 bg-gray-200 rounded hover:bg-gray-300 text-xl">9</button>
            <button class="num-btn px-4 py-4 bg-gray-200 rounded hover:bg-gray-300 text-xl">0</button>
            <button id="clear-btn" class="num-btn px-4 py-4 bg-red-500 text-white rounded hover:bg-red-600 text-xl">æ¸…é™¤ | Clear</button>
            <button id="submit-btn" class="num-btn px-4 py-4 bg-green-500 text-white rounded hover:bg-green-600 text-xl">ç¢ºèª | Confirm</button>
        </div>
        <!-- å³é‚Šï¼šé¡¯ç¤ºéš¨æ©Ÿç¡¬å¹£ | Right: Display Random Coins -->
        <div class="w-full max-w-4xl p-4 bg-white rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">ç¡¬å¹£ | Coins</h2>
            <div id="random-coins" class="flex flex-col"></div>
        </div>
        <!-- å‹•ç•«æ•ˆæœå®¹å™¨ | Animation Effect Container -->
        <div id="celebration" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
            <div class="text-6xl animate-bounce">ğŸ‰ æ­£ç¢ºï¼ | Correct!</div>
        </div>
        <!-- éŠæˆ²çµæŸç•«é¢ | Game Over Screen -->
        <div id="game-over" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
            <div class="bg-white p-6 rounded-lg shadow-lg text-center">
                <h2 class="text-2xl font-bold mb-4">éŠæˆ²çµæŸï¼ | Game Over!</h2>
                <p id="final-stars" class="text-xl mb-2"></p>
                <p id="final-time" class="text-xl mb-4"></p>
                <input id="player-name" type="text" placeholder="è¼¸å…¥ä½ çš„åå­— | Enter Your Name" class="p-2 border rounded mb-4">
                <button id="save-score" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">ä¿å­˜ | Save</button>
                <h3 class="text-xl font-semibold mt-4">æ’è¡Œæ¦œ | Leaderboard</h3>
                <ul id="leaderboard" class="text-left"></ul>
            </div>
        </div>
        <!-- Footer -->
        <footer class="mt-4">
            <p>Â© 2025 ukawai</p>
        </footer>
    </div>

    <script>
        // ç¡¬å¹£æ•¸æ“š | Coin Data
        const imageFiles = ['01.jpg', '02.jpg', '05.jpg', '10.jpg', '20.jpg', '50.jpg', '100.jpg'];
        const coins = imageFiles.map(file => ({
            name: file,
            value: parseInt(file.split('.')[0]) / 10
        }));

        let totalValue = 0; // ç•¶å‰é¡Œç›®ç¸½é‡‘é¡ | Current Question Total Amount
        let inputValue = { dollars: null, cents: null }; // ç”¨æˆ¶è¼¸å…¥çš„é‡‘é¡ | User Input Amount
        let starCount = 0; // æ˜Ÿæ˜Ÿæ•¸ | Star Count
        let startTime = null; // éŠæˆ²é–‹å§‹æ™‚é–“ | Game Start Time
        let randomCoins = {}; // ç•¶å‰é¡Œç›®ç¡¬å¹£ | Current Question Coins
        let isInputCents = false; // æ˜¯å¦è¼¸å…¥æ¯« | Whether Inputting Cents
        let difficulty = null; // ç•¶å‰é›£åº¦ | Current Difficulty
        let usedCombinations = []; // å„²å­˜å·²ä½¿ç”¨çš„ç¡¬å¹£çµ„åˆ | Store Used Coin Combinations

        // é›£åº¦è¨­å®š | Difficulty Settings
        const difficultySettings = {
            easy: { minCoins: 3, maxCoins: 5, maxTypes: 2, maxStars: 5 },
            normal: { minCoins: 3, maxCoins: 8, maxTypes: 3, maxStars: 10 },
            hard: { minCoins: 5, maxCoins: 15, maxTypes: 5, maxStars: 10 }
        };

        // æ ¼å¼åŒ–åƒ¹å€¼é¡¯ç¤º | Format Value Display
        function formatValue(value) {
            if (value < 1) {
                const avos = (value * 100).toFixed(0);
                return `${(value * 10).toFixed(0)}æ¯« | ${avos} Avos`;
            }
            return `${value.toFixed(0)}åœ“ | ${value.toFixed(0)} Patacas`;
        }

        // æ›´æ–°è¼¸å…¥é‡‘é¡é¡¯ç¤º | Update Input Amount Display
        function updateInputAmount() {
            const dollars = inputValue.dollars !== null ? inputValue.dollars : 'ï¼Ÿ';
            const cents = inputValue.cents !== null ? inputValue.cents : 'ï¼Ÿ';
            const dollarDisplay = !isInputCents ? `<span class="blink">${dollars}</span>` : dollars;
            const centDisplay = isInputCents ? `<span class="blink">${cents}</span>` : cents;
            const avosDisplay = cents === 'ï¼Ÿ' ? 'ï¼Ÿ' : cents * 10;
            document.getElementById('input-amount').innerHTML = `${dollarDisplay} åœ“ ${centDisplay} æ¯« | ${dollarDisplay} Patacas ${avosDisplay} Avos`;
        }

        // æ¸²æŸ“æ˜Ÿæ˜Ÿæ•¸ | Render Star Count
        function renderStars() {
            const starDiv = document.getElementById('star-count');
            starDiv.innerHTML = '';
            for (let i = 0; i < starCount; i++) {
                const img = document.createElement('img');
                img.src = 'images/star.png';
                img.className = 'w-6 h-6';
                starDiv.appendChild(img);
            }
        }

        // éš¨æ©Ÿé¸æ“‡ç¡¬å¹£é¡å‹ | Randomly Select Coin Types
        function getRandomCoinTypes(maxTypes) {
            const shuffled = coins.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, Math.min(maxTypes, coins.length));
        }

        // æª¢æŸ¥ç¡¬å¹£çµ„åˆæ˜¯å¦å·²ä½¿ç”¨ | Check if Coin Combination is Used
        function isCombinationUsed(newCombination) {
            return usedCombinations.some(used => {
                return Object.keys(newCombination).length === Object.keys(used).length &&
                    Object.keys(newCombination).every(key => newCombination[key] === used[key]);
            });
        }

        // æª¢æŸ¥æ¯«ç¡¬å¹£æ˜¯å¦éœ€è¦é€²ä½ | Check if Avos Coins Require Carrying
        function requiresCarrying(coinCounts) {
            let totalAvos = 0;
            if (coinCounts['01.jpg']) totalAvos += coinCounts['01.jpg'] * 1; // 0.1 Patacas = 1 Avo
            if (coinCounts['02.jpg']) totalAvos += coinCounts['02.jpg'] * 2; // 0.2 Patacas = 2 Avos
            if (coinCounts['05.jpg']) totalAvos += coinCounts['05.jpg'] * 5; // 0.5 Patacas = 5 Avos
            return totalAvos >= 10; // Carrying required if total avos >= 10
        }

        // ç”Ÿæˆéš¨æ©Ÿç¡¬å¹£ï¼ˆç¢ºä¿ä¸é‡è¤‡ï¼Œä¸”ç°¡å–®/æ™®é€šæ¨¡å¼ä¸éœ€é€²ä½ï¼‰ | Generate Random Coins
        function generateRandomCoins() {
            const settings = difficultySettings[difficulty];
            let attempts = 0;
            const maxAttempts = 100;

            do {
                randomCoins = {};
                totalValue = 0;
                const coinCount = Math.floor(Math.random() * (settings.maxCoins - settings.minCoins + 1)) + settings.minCoins;
                const selectedCoins = getRandomCoinTypes(settings.maxTypes);

                for (let i = 0; i < coinCount; i++) {
                    const coin = selectedCoins[Math.floor(Math.random() * selectedCoins.length)];
                    randomCoins[coin.name] = (randomCoins[coin.name] || 0) + 1;
                    totalValue += coin.value;
                }

                // åœ¨ç°¡å–®å’Œæ™®é€šæ¨¡å¼ä¸‹ï¼Œæª¢æŸ¥æ¯«ç¡¬å¹£æ˜¯å¦éœ€è¦é€²ä½
                if (difficulty !== 'hard' && requiresCarrying(randomCoins)) {
                    continue; // å¦‚æœéœ€è¦é€²ä½ï¼Œé‡æ–°ç”Ÿæˆ
                }

                attempts++;
                if (attempts >= maxAttempts) {
                    console.warn('é”åˆ°æœ€å¤§å˜—è©¦æ¬¡æ•¸ï¼Œå¯èƒ½ç„¡æ³•ç”Ÿæˆæ›´å¤šå”¯ä¸€çµ„åˆ | Maximum attempts reached');
                    break;
                }
            } while (isCombinationUsed(randomCoins));

            usedCombinations.push({ ...randomCoins });
            renderRandomCoins();
        }

        // æ¸²æŸ“éš¨æ©Ÿç¡¬å¹£ï¼ˆæŒ‰åƒ¹å€¼æ’åºï¼‰ | Render Random Coins (Sorted by Value)
        function renderRandomCoins() {
            const coinDiv = document.getElementById('random-coins');
            coinDiv.innerHTML = '';
            const sortedCoins = Object.keys(randomCoins).sort((a, b) => {
                return parseInt(a.split('.')[0]) - parseInt(b.split('.')[0]);
            });
            sortedCoins.forEach(name => {
                const count = randomCoins[name];
                const value = parseInt(name.split('.')[0]) / 10;
                const div = document.createElement('div');
                div.className = 'flex items-center mb-2';
                let images = '';
                for (let i = 0; i < count; i++) {
                    images += `<img src="images/${name}" alt="${name}" class="w-10 h-10 mr-2">`;
                }
                div.innerHTML = `
                    <div class="flex flex-wrap items-center">
                        <span class="mr-2">${formatValue(value)}:</span>
                        ${images}
                    </div>
                `;
                coinDiv.appendChild(div);
            });
        }

        // è™•ç†æ•¸å­—éµç›¤è¼¸å…¥ | Handle Number Keypad Input
        function handleNumberInput(num) {
            if (!isInputCents) {
                if (inputValue.dollars === null) {
                    inputValue.dollars = num;
                } else if (inputValue.dollars < 100) {
                    inputValue.dollars = inputValue.dollars * 10 + num;
                }
            } else {
                inputValue.cents = num;
            }
            updateInputAmount();
        }

        // æ¸…é™¤è¼¸å…¥ | Clear Input
        function clearInput() {
            inputValue = { dollars: null, cents: null };
            isInputCents = false;
            updateInputAmount();
        }

        // æª¢æŸ¥ç­”æ¡ˆ | Check Answer
        function checkAnswer() {
            const inputDollars = inputValue.dollars || 0;
            const inputCents = inputValue.cents || 0;
            const inputTotal = inputDollars + inputCents / 10;
            if (Math.abs(inputTotal - totalValue) < 0.01) {
                starCount++;
                renderStars();
                showCelebration();
                setTimeout(nextQuestion, 1500);
            }
            clearInput();
        }

        // é¡¯ç¤ºæ…¶ç¥å‹•ç•« | Show Celebration Animation
        function showCelebration() {
            const celebration = document.getElementById('celebration');
            celebration.classList.remove('hidden');
            setTimeout(() => {
                celebration.classList.add('hidden');
            }, 1000);
        }

        // é€²å…¥ä¸‹ä¸€é¡Œ | Proceed to Next Question
        function nextQuestion() {
            const settings = difficultySettings[difficulty];
            if (starCount >= settings.maxStars) {
                endGame();
            } else {
                generateRandomCoins();
                clearInput();
            }
        }

        // çµæŸéŠæˆ² | End Game
        function endGame() {
            const endTime = new Date();
            const timeTaken = Math.round((endTime - startTime) / 1000);
            const gameOver = document.getElementById('game-over');
            document.getElementById('final-stars').textContent = `ç²å¾—æ˜Ÿæ˜Ÿ | Stars Earned: ${starCount}`;
            document.getElementById('final-time').textContent = `ç”¨æ™‚ | Time Taken: ${timeTaken} ç§’ | Seconds`;
            gameOver.classList.remove('hidden');
        }

        // ä¿å­˜æˆç¸¾ä¸¦é¡¯ç¤ºæ’è¡Œæ¦œ | Save Score and Display Leaderboard
        function saveScore() {
            const name = document.getElementById('player-name').value || 'åŒ¿å | Anonymous';
            const timeTaken = Math.round((new Date() - startTime) / 1000);
            const leaderboard = JSON.parse(localStorage.getItem('leaderboard') || '[]');
            leaderboard.push({ name, time: timeTaken, stars: starCount, difficulty });
            leaderboard.sort((a, b) => a.time - b.time);
            leaderboard.splice(5);
            localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
            renderLeaderboard();
            document.getElementById('player-name').disabled = true;
            document.getElementById('save-score').disabled = true;
        }

        // æ¸²æŸ“æ’è¡Œæ¦œ | Render Leaderboard
        function renderLeaderboard() {
            const leaderboardList = document.getElementById('leaderboard');
            const leaderboard = JSON.parse(localStorage.getItem('leaderboard') || '[]');
            leaderboardList.innerHTML = '';
            leaderboard.forEach((entry, index) => {
                const li = document.createElement('li');
                li.textContent = `${index + 1}. ${entry.name} - ${entry.stars} æ˜Ÿ | Stars, ${entry.time} ç§’ | Seconds (${entry.difficulty})`;
                leaderboardList.appendChild(li);
            });
        }

        // åˆå§‹åŒ– | Initialize
        function init() {
            clearInput();
            document.getElementById('easy-btn').addEventListener('click', () => startGame('easy'));
            document.getElementById('normal-btn').addEventListener('click', () => startGame('normal'));
            document.getElementById('hard-btn').addEventListener('click', () => startGame('hard'));
        }

        // é–‹å§‹éŠæˆ² | Start Game
        function startGame(selectedDifficulty) {
            difficulty = selectedDifficulty;
            startTime = new Date();
            starCount = 0;
            usedCombinations = [];
            document.getElementById('difficulty-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            generateRandomCoins();
            renderStars();
            renderLeaderboard();

            document.querySelectorAll('.num-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (btn.id === 'clear-btn') {
                        clearInput();
                    } else if (btn.id === 'submit-btn') {
                        isInputCents = !isInputCents;
                        if (!isInputCents) checkAnswer();
                        updateInputAmount();
                    } else {
                        handleNumberInput(parseInt(btn.textContent));
                    }
                });
            });

            document.getElementById('save-score').addEventListener('click', saveScore);
        }

        init();
    </script>
</body>
</html>
