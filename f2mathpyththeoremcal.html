<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>勾股定理練習題</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            max-width: 100%;
            overflow-x: hidden;
        }
        h1 {
            font-size: 1.5em;
            text-align: center;
        }
        #question {
            margin: 15px 0;
            font-size: 1.1em;
            word-wrap: break-word;
            text-align: center;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px auto;
            max-width: 300px;
        }
        .option {
            padding: 15px;
            border: 1px solid #ccc;
            text-align: center;
            cursor: pointer;
            background-color: #fff;
            font-size: 1em;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .option:hover {
            background-color: #f0f0f0;
        }
        .disabled {
            pointer-events: none;
            opacity: 0.6;
        }
        #feedback, #progress {
            text-align: center;
            margin: 10px 0;
        }
        #wrongAnswers {
            margin-top: 20px;
        }
        @media (max-width: 400px) {
            .grid {
                grid-template-columns: repeat(3, 1fr);
                max-width: 100%;
                gap: 5px;
            }
            .option {
                padding: 10px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <h1>勾股定理練習題</h1>
    <div id="question"></div>
    <div id="grid" class="grid"></div>
    <div id="feedback"></div>
    <div id="progress">已完成: 0/5</div>
    <div id="wrongAnswers"></div>

    <script>
        let correctCount = 0;
        let totalCount = 0;
        let wrongProblems = new Map();
        const TOTAL_QUESTIONS = 5; // 總共需要完成的題數，在此修改即可

        // 簡化二次根式
        function simplifyRoot(n) {
            let coefficient = 1;
            let radicand = n;
            for (let i = 2; i * i <= n; i++) {
                while (radicand % (i * i) === 0) {
                    coefficient *= i;
                    radicand /= i * i;
                }
            }
            return { coefficient: coefficient, radicand: radicand };
        }

        // 計算邊長的平方值以比較大小
        function getSideValue(side) {
            return side.isRoot ? side.coefficient * side.coefficient * side.radicand : side.value * side.value;
        }

        function generateProblem() {
            const hasRoot = Math.random() < 0.5;
            let leg1, leg2;

            if (hasRoot) {
                const roots = [3, 5, 7, 11, 13, 15];
                leg1 = { coefficient: 1, radicand: roots[Math.floor(Math.random() * roots.length)], isRoot: true };
                leg2 = { value: Math.floor(Math.random() * 15) + 1, isRoot: false };
            } else {
                leg1 = { value: Math.floor(Math.random() * 15) + 1, isRoot: false };
                leg2 = { value: Math.floor(Math.random() * 15) + 1, isRoot: false };
            }

            const leg1Value = leg1.isRoot ? leg1.radicand * leg1.coefficient * leg1.coefficient : leg1.value * leg1.value;
            const leg2Value = leg2.isRoot ? leg2.radicand * leg2.coefficient * leg2.coefficient : leg2.value * leg2.value;
            const hypotenuseRoot = leg1Value + leg2Value;
            const simplifiedHypotenuse = simplifyRoot(hypotenuseRoot);
            const hypotenuse = { 
                coefficient: simplifiedHypotenuse.coefficient, 
                radicand: simplifiedHypotenuse.radicand, 
                isRoot: true 
            };

            // 將三條邊放入陣列並隨機排序
            const sidesData = [leg1, leg2, hypotenuse];
            const sides = [
                { name: 'a', data: null, angle: 'A' },
                { name: 'b', data: null, angle: 'B' },
                { name: 'c', data: null, angle: 'C' }
            ];

            // 隨機分配邊長
            for (let i = sidesData.length - 1; i >= 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [sidesData[i], sidesData[j]] = [sidesData[j], sidesData[i]];
            }
            sides[0].data = sidesData[0];
            sides[1].data = sidesData[1];
            sides[2].data = sidesData[2];

            // 找出最長邊（斜邊）及其對應的角
            const hypotenuseSide = sides.reduce((max, side) => 
                getSideValue(side.data) > getSideValue(max.data) ? side : max
            );

            const givenSides = sides.sort(() => Math.random() - 0.5).slice(0, 2);
            const answerSide = sides.find(s => !givenSides.includes(s));

            const question = `直角三角形ABC中，${hypotenuseSide.angle}為直角，` +
                `${givenSides[0].name} = ${formatNumber(givenSides[0].data)}，` +
                `${givenSides[1].name} = ${formatNumber(givenSides[1].data)}，` +
                `求${answerSide.name}的長度`;

            document.getElementById('question').textContent = question;
            generateOptions(answerSide.data);
            return { question: question, answer: formatNumber(answerSide.data) };
        }

        function formatNumber(data) {
            if (!data.isRoot) return data.value;
            if (data.coefficient === 1 && data.radicand === 1) return 1;
            if (data.coefficient === 1) return `√${data.radicand}`;
            if (data.radicand === 1) return data.coefficient;
            return `${data.coefficient}√${data.radicand}`;
        }

        function generateOptions(correctAnswer) {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            const options = new Set();
            options.add(JSON.stringify(correctAnswer));

            while (options.size < 9) {
                const hasRoot = Math.random() < 0.5;
                let option;
                if (hasRoot) {
                    const roots = [2, 3, 5, 6, 7, 10, 11, 13, 14, 15, 17, 19, 21, 23];
                    const root = roots[Math.floor(Math.random() * roots.length)];
                    const simplified = simplifyRoot(root);
                    option = { 
                        coefficient: simplified.coefficient, 
                        radicand: simplified.radicand, 
                        isRoot: true 
                    };
                } else {
                    option = { value: Math.floor(Math.random() * 15) + 1, isRoot: false };
                }
                options.add(JSON.stringify(option));
            }

            const optionArray = Array.from(options).map(str => JSON.parse(str)).sort(() => Math.random() - 0.5);

            optionArray.forEach(data => {
                const div = document.createElement('div');
                div.className = 'option';
                div.textContent = formatNumber(data);
                div.onclick = () => checkAnswer(data, correctAnswer);
                grid.appendChild(div);
            });
        }

        function checkAnswer(selected, correct) {
            const feedback = document.getElementById('feedback');
            const grid = document.getElementById('grid');
            const isCorrect = (!selected.isRoot && !correct.isRoot && selected.value === correct.value) ||
                            (selected.isRoot && correct.isRoot && 
                             selected.coefficient === correct.coefficient && 
                             selected.radicand === correct.radicand);

            const currentQuestion = document.getElementById('question').textContent;
            const correctAnswerText = formatNumber(correct);

            if (isCorrect) {
                feedback.textContent = '回答正確！';
                correctCount++;
                totalCount++;
                grid.classList.add('disabled');

                setTimeout(() => {
                    feedback.textContent = '';
                    grid.classList.remove('disabled');
                    nextProblem();
                }, 1000);
            } else {
                feedback.textContent = '你答錯了，請重試！';
                totalCount++;
                wrongProblems.set(currentQuestion, correctAnswerText);
            }

            document.getElementById('progress').textContent = `已完成: ${correctCount}/${TOTAL_QUESTIONS}`;
        }

        function nextProblem() {
            if (correctCount >= TOTAL_QUESTIONS) {
                showResults();
            } else {
                generateProblem();
            }
        }

        function showResults() {
            const wrongDiv = document.getElementById('wrongAnswers');
            wrongDiv.innerHTML = '<h2>錯題回顧:</h2>';
            if (wrongProblems.size === 0) {
                wrongDiv.innerHTML += '<p>恭喜你！沒有錯題！</p>';
            } else {
                wrongProblems.forEach((answer, problem) => {
                    wrongDiv.innerHTML += `<p>${problem} 正確答案：${answer}</p>`;
                });
            }
            document.getElementById('grid').innerHTML = '';
            document.getElementById('question').textContent = '練習已完成！';
        }

        // 開始第一題
        document.getElementById('progress').textContent = `已完成: 0/${TOTAL_QUESTIONS}`;
        generateProblem();
    </script>
</body>
</html>