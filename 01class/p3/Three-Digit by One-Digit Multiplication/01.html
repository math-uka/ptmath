<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Multiplication Teaching Tool 13</title>
    <!-- MathJax for mathematical expressions -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .equation-container {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        .equals-sign {
            width: 20px;
            text-align: right;
            flex-shrink: 0;
            padding-right: 5px;
        }
        .math-expression {
            flex-grow: 1;
            text-align: left;
        }
        #horizontal, #vertical {
            min-height: 400px;
            max-width: 50%;
            display: flex;
            flex-direction: column;
        }
        #horizontal-steps, #vertical-steps {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        #vertical-steps {
            justify-content: center;
            align-items: center;
        }
        .input-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-bottom: 1rem;
        }
        .input-container input {
            width: 80px;
            padding: 4px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
            -webkit-appearance: none;
            -moz-appearance: textfield;
        }
        .input-container input:invalid {
            border-color: red;
        }
        @media (max-width: 640px) {
            #horizontal, #vertical {
                max-width: 100%;
                min-height: 350px;
            }
            .text-2xl {
                font-size: 1.25rem;
            }
            .p-6 {
                padding: 1rem;
            }
            .py-4 {
                padding-top: 0.5rem;
                padding-bottom: 0.5rem;
            }
            .input-container input {
                width: 60px;
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen">
    <header class="bg-blue-600 text-white py-4 text-center">
        <h1 class="text-xl sm:text-2xl font-bold">三位數乘一位數 / Three-Digit by One-Digit Multiplication</h1>
    </header>
    <main class="flex-grow flex flex-col p-4 gap-4">
        <!-- Input Box for Problem -->
        <div class="input-container">
            <input type="text" id="three-digit" pattern="[1-9][0-9]{2}" value="123" required>
            <span class="text-xl">×</span>
            <input type="text" id="one-digit" pattern="[1-9]" value="5" required>
        </div>
        <div class="flex flex-col md:flex-row justify-center items-start gap-4">
            <!-- Left Side: Horizontal Multiplication -->
            <section id="horizontal" class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-lg sm:text-xl font-semibold mb-4 text-center">橫式乘法 / Horizontal Method</h2>
                <div id="horizontal-steps" class="text-2xl mb-4 flex flex-col items-center"></div>
                <button id="horizontal-next-step" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 w-full text-base sm:text-lg">下一步 / Next Step</button>
            </section>
            <!-- Right Side: Vertical Multiplication -->
            <section id="vertical" class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-lg sm:text-xl font-semibold mb-4 text-center">直式乘法 / Vertical Method</h2>
                <div id="vertical-steps" class="text-2xl mb-4"></div>
                <button id="vertical-next-step" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 w-full text-base sm:text-lg">下一步 / Next Step</button>
            </section>
        </div>
        <div class="text-center mt-4">
            <button id="new-problem" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600 text-base sm:text-lg">重新出題 / Generate New Problem</button>
        </div>
    </main>
    <footer class="bg-gray-800 text-white text-center py-4">
        <p>© 2025 ukawai</p>
    </footer>
    <script>
        let threeDigit = 123;
        let oneDigit = 5;
        let hundreds, tens, unitsDigit;
        let horizontalStep = 0;
        let verticalStep = 0;

        function updateProblem() {
            hundreds = Math.floor(threeDigit / 100) * 100;
            tens = Math.floor((threeDigit % 100) / 10) * 10;
            unitsDigit = threeDigit % 10;
            horizontalStep = 0;
            verticalStep = 0;
            updateHorizontalSteps();
            updateVerticalSteps();
        }

        function generateProblem() {
            const hundredsDigit = Math.floor(Math.random() * 9) + 1;
            const tensDigit = Math.floor(Math.random() * 10);
            const units = Math.floor(Math.random() * 9) + 1;
            threeDigit = hundredsDigit * 100 + tensDigit * 10 + units;
            oneDigit = Math.floor(Math.random() * 9) + 1;
            document.getElementById('three-digit').value = threeDigit;
            document.getElementById('one-digit').value = oneDigit;
            updateProblem();
        }

        function getHorizontalSteps() {
            return [
                `${threeDigit} \\times ${oneDigit}`,
                `(${hundreds} + ${tens} + ${unitsDigit}) \\times ${oneDigit}`,
                `${hundreds} \\times ${oneDigit} + ${tens} \\times ${oneDigit} + ${unitsDigit} \\times ${oneDigit}`,
                `${hundreds * oneDigit} + ${tens * oneDigit} + ${unitsDigit * oneDigit}`,
                `${threeDigit * oneDigit}`
            ];
        }

        function getVerticalSteps() {
            return [
                `\\begin{array}{r} ${threeDigit} \\\\ \\times ${oneDigit} \\\\ \\hline \\end{array}`,
                `\\begin{array}{r} ${threeDigit} \\\\ \\times ${oneDigit} \\\\ \\hline ${unitsDigit * oneDigit} \\end{array}`,
                `\\begin{array}{r} ${threeDigit} \\\\ \\times ${oneDigit} \\\\ \\hline ${unitsDigit * oneDigit} \\\\ ${tens * oneDigit / 10}\\phantom{0} \\end{array}`,
                `\\begin{array}{r} ${threeDigit} \\\\ \\times ${oneDigit} \\\\ \\hline ${unitsDigit * oneDigit} \\\\ ${tens * oneDigit / 10}\\phantom{0} \\\\ ${hundreds * oneDigit / 100}\\phantom{00} \\end{array}`,
                `\\begin{array}{r} ${threeDigit} \\\\ \\times ${oneDigit} \\\\ \\hline ${unitsDigit * oneDigit} \\\\ ${tens * oneDigit / 10}\\phantom{0} \\\\ ${hundreds * oneDigit / 100}\\phantom{00} \\\\ \\hline ${threeDigit * oneDigit} \\end{array}`
            ];
        }

        const horizontalDiv = document.getElementById('horizontal-steps');
        const verticalDiv = document.getElementById('vertical-steps');
        const horizontalNextButton = document.getElementById('horizontal-next-step');
        const verticalNextButton = document.getElementById('vertical-next-step');
        const newProblemButton = document.getElementById('new-problem');
        const threeDigitInput = document.getElementById('three-digit');
        const oneDigitInput = document.getElementById('one-digit');

        function updateHorizontalSteps() {
            const horizontalSteps = getHorizontalSteps();
            horizontalDiv.innerHTML = '';
            for (let i = 0; i <= Math.min(horizontalStep, horizontalSteps.length - 1); i++) {
                const stepDiv = document.createElement('div');
                stepDiv.classList.add('equation-container', 'py-1');
                const equalsDiv = document.createElement('div');
                equalsDiv.classList.add('equals-sign');
                equalsDiv.innerHTML = i === 0 ? '' : '=';
                const mathDiv = document.createElement('div');
                mathDiv.classList.add('math-expression');
                mathDiv.innerHTML = `\\(${horizontalSteps[i]}\\)`;
                stepDiv.appendChild(equalsDiv);
                stepDiv.appendChild(mathDiv);
                horizontalDiv.appendChild(stepDiv);
            }

            MathJax.typesetPromise().catch(err => console.error('MathJax typesetting failed:', err));

            horizontalNextButton.disabled = horizontalStep >= horizontalSteps.length - 1;
            horizontalNextButton.classList.toggle('bg-green-500', !horizontalNextButton.disabled);
            horizontalNextButton.classList.toggle('hover:bg-green-600', !horizontalNextButton.disabled);
            horizontalNextButton.classList.toggle('bg-gray-400', horizontalNextButton.disabled);
            horizontalNextButton.classList.toggle('cursor-not-allowed', horizontalNextButton.disabled);
        }

        function updateVerticalSteps() {
            const verticalSteps = getVerticalSteps();
            // Always display at least the first step
            verticalDiv.innerHTML = `\\(${verticalSteps[Math.min(verticalStep, verticalSteps.length - 1)]}\\)`;
            MathJax.typesetPromise().catch(err => console.error('MathJax typesetting failed:', err));

            verticalNextButton.disabled = verticalStep >= verticalSteps.length - 1;
            verticalNextButton.classList.toggle('bg-green-500', !verticalNextButton.disabled);
            verticalNextButton.classList.toggle('hover:bg-green-600', !verticalNextButton.disabled);
            verticalNextButton.classList.toggle('bg-gray-400', verticalNextButton.disabled);
            verticalNextButton.classList.toggle('cursor-not-allowed', verticalNextButton.disabled);
        }

        function validateAndUpdate() {
            const newThreeDigit = parseInt(threeDigitInput.value);
            const newOneDigit = parseInt(oneDigitInput.value);

            if (newThreeDigit >= 100 && newThreeDigit <= 999 && newOneDigit >= 1 && newOneDigit <= 9) {
                threeDigit = newThreeDigit;
                oneDigit = newOneDigit;
                updateProblem();
            } else {
                threeDigitInput.setCustomValidity('請輸入100-999');
                oneDigitInput.setCustomValidity('請輸入1-9');
            }
        }

        threeDigitInput.addEventListener('input', () => {
            threeDigitInput.setCustomValidity('');
            if (/^[1-9][0-9]{0,2}$/.test(threeDigitInput.value)) {
                validateAndUpdate();
            }
        });

        oneDigitInput.addEventListener('input', () => {
            oneDigitInput.setCustomValidity('');
            if (/^[1-9]$/.test(oneDigitInput.value)) {
                validateAndUpdate();
            }
        });

        horizontalNextButton.addEventListener('click', () => {
            if (horizontalStep < getHorizontalSteps().length - 1) {
                horizontalStep++;
                updateHorizontalSteps();
            }
        });

        verticalNextButton.addEventListener('click', () => {
            if (verticalStep < getVerticalSteps().length - 1) {
                verticalStep++;
                updateVerticalSteps();
            }
        });

        newProblemButton.addEventListener('click', generateProblem);

        // Initialize with first problem
        generateProblem();
    </script>
</body>
</html>
