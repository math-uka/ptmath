<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>積的乘方工具與教學</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --primary-color: #1e88e5;
            --secondary-color: #43a047;
            --accent-color: #e53935;
            --light-gray: #f5f5f5;
            --dark-gray: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: var(--dark-gray);
            background-color: #fafafa;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
        }

        h1, h2, h3 {
            color: var(--primary-color);
        }

        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 30px;
        }

        .input-container {
            margin: 20px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        input {
            padding: 12px;
            flex: 1;
            min-width: 200px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }

        button {
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #1565c0;
        }

        .result-container {
            margin-top: 20px;
            padding: 20px;
            background-color: var(--light-gray);
            border-radius: 6px;
            font-size: 1.1em;
        }

        .step-container {
            margin: 20px 0;
            padding: 15px;
            background-color: #e3f2fd;
            border-left: 4px solid var(--primary-color);
            border-radius: 4px;
        }

        .step {
            margin-bottom: 15px;
        }

        .step-number {
            display: inline-block;
            width: 28px;
            height: 28px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 28px;
            margin-right: 10px;
            font-weight: bold;
        }

        .example {
            background-color: var(--light-gray);
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
        }

        footer {
            margin-top: 40px;
            text-align: center;
            font-size: 0.9em;
            color: #777;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .preview-container {
            margin: 20px 0;
            padding: 15px;
            background-color: var(--light-gray);
            border-radius: 6px;
            text-align: center;
            font-size: 1.2em;
        }

        .exercise-container {
            margin: 20px 0;
        }

        .exercise {
            margin-bottom: 20px;
        }

        .exercise p {
            margin: 10px 0;
        }

        .answer {
            display: none;
            padding: 10px;
            background-color: #e3f2fd;
            border-radius: 4px;
            margin-top: 10px;
        }

        .answer-button {
            background-color: var(--secondary-color);
        }

        .answer-button:hover {
            background-color: #2e7d32;
        }
    </style>
</head>
<body>
    <header>
        <h1>積的乘方互動學習工具</h1>
        <p>通過直觀的步驟展示和互動計算器，輕鬆掌握積的乘方的核心原理！</p>
        <p>輸入一個積及其次方，如 \( 2a^3b \) 和 \( 3 \)，即可查看逐步計算過程與最終結果。</p>
    </header>

    <div class="card">
        <h2>積的乘方計算器</h2>
        <div class="input-container">
            <input type="text" id="product" value="2a^3b" placeholder="例如: 2a^3b 或 -3x^2y">
            <span style="font-size: 1.5em;">^</span>
            <input type="text" id="exponent" value="3" placeholder="例如: 3">
            <button onclick="calculateProductPower()">計算結果</button>
        </div>
        <div class="preview-container">
            <h3>當前運算</h3>
            <div id="preview">\[ (2a^3b)^3 \]</div>
        </div>
        <div id="result-container" class="result-container"></div>
    </div>

    <div class="card">
        <h2>積的乘方教學</h2>
        <p>積的乘方是代數中的基本運算，遵循每個因子指數相乘的規則。以下是詳細步驟：</p>

        <div class="step">
            <h3><span class="step-number">1</span>理解積的乘方</h3>
            <p>積的乘方表示將一個包含係數和變數的表達式乘以自身多次。例如：</p>
            <p class="example">\( (2a^3b)^3 = (2a^3b) \cdot (2a^3b) \cdot (2a^3b) \)</p>
            <p>其中 \( 2 \) 是係數，\( a^3 \) 和 \( b \) 是變數的冪，\( 3 \) 是外指數。</p>
        </div>

        <div class="step">
            <h3><span class="step-number">2</span>計算步驟</h3>
            <p>以 \( (2a^3b)^3 \) 為例，計算過程如下：</p>
            <ul>
                <li>表示形式：\( (2a^3b)^3 = (2a^3b) \cdot (2a^3b) \cdot (2a^3b) \)</li>
                <li>展開：\( = (2 \cdot a^3 \cdot b) \cdot (2 \cdot a^3 \cdot b) \cdot (2 \cdot a^3 \cdot b) \)</li>
                <li>分組：\( = (2 \cdot 2 \cdot 2) \cdot (a^3 \cdot a^3 \cdot a^3) \cdot (b \cdot b \cdot b) \)</li>
                <li>計算：\( = 2^3 \cdot a^{3 \cdot 3} \cdot b^3 = 8a^9b^3 \)</li>
            </ul>
        </div>

        <div class="step">
            <h3><span class="step-number">3</span>積的乘方規則</h3>
            <p>當一個積被乘方時，係數和每個變數的指數分別與外指數相乘：</p>
            <p class="example">\( (k \cdot x^m \cdot y^n)^p = k^p \cdot x^{m \cdot p} \cdot y^{n \cdot p} \)</p>
            <p>例如：\( (2a^3b)^3 = 2^3 \cdot a^{3 \cdot 3} \cdot b^{1 \cdot 3} = 8a^9b^3 \)</p>
            <p>或：\( (-3x^2y)^2 = (-3)^2 \cdot x^{2 \cdot 2} \cdot y^{1 \cdot 2} = 9x^4y^2 \)</p>
        </div>

        <div class="step">
            <h3><span class="step-number">4</span>常見錯誤與注意事項</h3>
            <ul>
                <li><strong>係數處理</strong>：係數也需乘方，例如 \( (2a^3b)^3 \) 中 \( 2^3 = 8 \)，不能忽略係數。</li>
                <li><strong>指數相乘而非相加</strong>：錯誤：\( (a^3)^3 = a^{3+3} \)，正確：\( a^{3 \cdot 3} = a^9 \)</li>
                <li><strong>負係數</strong>：負係數乘方時注意正負：\( (-3)^2 = 9 \)，\( (-3)^3 = -27 \)</li>
            </ul>
        </div>
    </div>

    <div class="card">
        <h2>隨堂練習</h2>
        <p>請計算以下積的乘方的結果，點擊「顯示答案」按鈕查看正確答案。</p>
        <div class="exercise-container">
            <div class="exercise">
                <p>1. \( (3a^2b)^2 \)</p>
                <button class="answer-button" onclick="toggleAnswer('answer1')">顯示答案</button>
                <div id="answer1" class="answer">\[ (3a^2b)^2 = 3^2 \cdot a^{2 \cdot 2} \cdot b^{1 \cdot 2} = 9a^4b^2 \]</div>
            </div>
            <div class="exercise">
                <p>2. \( (-2xy^3)^3 \)</p>
                <button class="answer-button" onclick="toggleAnswer('answer2')">顯示答案</button>
                <div id="answer2" class="answer">\[ (-2xy^3)^3 = (-2)^3 \cdot x^{1 \cdot 3} \cdot y^{3 \cdot 3} = -8x^3y^9 \]</div>
            </div>
            <div class="exercise">
                <p>3. \( (4a^5b^2)^2 \)</p>
                <button class="answer-button" onclick="toggleAnswer('answer3')">顯示答案</button>
                <div id="answer3" class="answer">\[ (4a^5b^2)^2 = 4^2 \cdot a^{5 \cdot 2} \cdot b^{2 \cdot 2} = 16a^{10}b^4 \]</div>
            

            </div>
            <div class="exercise">
                <p>4. \( (2^5x^2y)^2 \)</p>
                <button class="answer-button" onclick="toggleAnswer('answer4')">顯示答案</button>
                <div id="answer4" class="answer">\[ (2^5x^2y)^2 = (2^5)^2 \cdot x^{2 \cdot 2} \cdot y^{1 \cdot 2} = 2^{10}x^4y^2 \]</div>
            </div>
            <div class="exercise">
                <p>5. \( (-5a^3b^4)^3 \)</p>
                <button class="answer-button" onclick="toggleAnswer('answer5')">顯示答案</button>
                <div id="answer5" class="answer">\[ (-5a^3b^4)^3 = (-5)^3 \cdot a^{3 \cdot 3} \cdot b^{4 \cdot 3} = -125a^9b^{12} \]</div>
            </div>
        </div>
    </div>

    <footer>
        <p>© ukawai</p>
    </footer>

    <script>
        // Disable right-click context menu
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            alert('右鍵功能已被禁用！');
        });

        // Disable F12 key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I')) {
                e.preventDefault();
                alert('開發者工具已被禁用！');
            }
        });

        // Toggle answer visibility
        function toggleAnswer(id) {
            let answer = document.getElementById(id);
            if (answer.style.display === 'block') {
                answer.style.display = 'none';
            } else {
                answer.style.display = 'block';
                MathJax.typesetPromise().catch(err => console.error('MathJax typesetting error:', err));
            }
        }

        // Real-time preview update
        function updatePreview() {
            let product = document.getElementById('product').value || '2a^3b';
            let exponent = document.getElementById('exponent').value || '3';
            let preview = `\\[ (${product.replace(/\^(\d+)/g, '^{$1}')})^{${exponent}} \\]`;
            document.getElementById('preview').innerHTML = preview;
            MathJax.typesetPromise().catch(err => console.error('MathJax typesetting error:', err));
        }

        // Add input event listeners for real-time updates
        document.getElementById('product').addEventListener('input', updatePreview);
        document.getElementById('exponent').addEventListener('input', updatePreview);

        // Initial preview render
        window.onload = updatePreview;

        function parseProduct(term) {
            term = term.replace(/\s/g, '');
            // Match coefficient (optional negative, number or power like 2^5) followed by up to two variables with optional exponents
            let match = term.match(/^(?:(-)?(\d+|\d+\^\d+))?([a-zA-Z])(?:\^(\d+))?([a-zA-Z])?(?:\^(\d+))?$/);
            if (!match) {
                throw new Error('請輸入有效積格式，例如 2a^3b、-3x^2y、2^5xy 或 -5ab^4');
            }
            let sign = match[1] || '';
            let coefficient = match[2] ? (match[2].includes('^') ? match[2] : parseInt(sign + match[2])) : 1;
            let var1 = match[3];
            let exp1 = match[4] ? parseInt(match[4]) : 1;
            let var2 = match[5] || '';
            let exp2 = match[6] ? parseInt(match[6]) : (match[5] ? 1 : 0);
            return { coefficient, var1, exp1, var2, exp2 };
        }

        function formatCoefficient(coef, exponent) {
            if (typeof coef === 'number') {
                let result = Math.pow(coef, exponent);
                return (result >= -100 && result <= 100) ? result : `${coef}^${exponent}`;
            }
            return `${coef}^${exponent}`;
        }

        function visualizeProduct(coefficient, var1, exp1, var2, exp2) {
            let parts = [];
            if (coefficient !== 1 || (!var1 && !var2)) parts.push(coefficient === -1 ? '-1' : coefficient);
            if (var1) parts.push(exp1 === 1 ? var1 : `${var1}^${exp1}`);
            if (var2) parts.push(exp2 === 1 ? var2 : `${var2}^${exp2}`);
            return parts.join('');
        }

        function formatVisualLatex(str) {
            str = String(str);
            str = str.replace(/\^(\d+)/g, '^{$1}');
            let terms = str.match(/-(?:\d+\^\{\d+\}|\d+|[a-zA-Z]\^\{\d+\}|[a-zA-Z])|(?:\d+\^\{\d+\}|\d+|[a-zA-Z]\^\{\d+\}|[a-zA-Z])/g) || [str];
            if (terms.length <= 1) return str;
            return terms.join(' \\cdot ').replace(/ \\cdot $/, '');
        }

        function formatFinalResult(str) {
            str = String(str);
            str = str.replace(/\^(\d+)/g, '^{$1}');
            let terms = str.match(/-(?:\d+\^\{\d+\}|\d+|[a-zA-Z]\^\{\d+\}|[a-zA-Z])|(?:\d+\^\{\d+\}|\d+|[a-zA-Z]\^\{\d+\}|[a-zA-Z])/g) || [str];
            if (terms.length <= 1) return str;
            return terms.join('');
        }

        function calculateProductPower() {
            let productInput = document.getElementById('product').value;
            let exponentInput = document.getElementById('exponent').value;
            if (!productInput || !exponentInput) {
                alert('請輸入積和外指數！');
                return;
            }

            try {
                let product = parseProduct(productInput);
                let exponent = parseInt(exponentInput);
                if (isNaN(exponent)) {
                    throw new Error('外指數必須是整數！');
                }

                let finalCoefficient = formatCoefficient(product.coefficient, exponent);
                let finalExp1 = product.exp1 * exponent;
                let finalExp2 = product.exp2 * exponent;
                let visualProduct = visualizeProduct(product.coefficient, product.var1, product.exp1, product.var2, product.exp2);
                let visualResult = visualizeProduct(finalCoefficient, product.var1, finalExp1, product.var2, finalExp2);
                let absExponent = Math.abs(exponent);

                let step2Line1, step2Line2;
                if (absExponent >= 5) {
                    step2Line1 = `${productInput.replace(/\^(\d+)/g, '^{$1}')} \\cdot ${productInput.replace(/\^(\d+)/g, '^{$1}')} \\cdot \\ldots \\cdot ${productInput.replace(/\^(\d+)/g, '^{$1}')}`;
                    step2Line2 = `\\underset{${absExponent}個(${formatVisualLatex(visualProduct)})}{(${formatVisualLatex(visualProduct)}) \\cdot (${formatVisualLatex(visualProduct)}) \\cdot \\ldots \\cdot (${formatVisualLatex(visualProduct)})}`;
                } else {
                    let repeatedProduct = Array(absExponent).fill(`(${productInput.replace(/\^(\d+)/g, '^{$1}')})`).join(' \\cdot ');
                    let repeatedVisualProduct = Array(absExponent).fill(`(${formatVisualLatex(visualProduct)})`).join(' \\cdot ');
                    step2Line1 = `${repeatedProduct}`;
                    step2Line2 = `${repeatedVisualProduct}`;
                }

                let coefficientDisplay = product.coefficient === 1 ? '' : (product.coefficient < 0 ? `(${product.coefficient})` : product.coefficient);
                let coefficientLine = coefficientDisplay ? `${coefficientDisplay}`.repeat(absExponent) : '';

                let steps = `
                    <div class="step-container">
                        <h3>計算過程</h3>
                        <div class="step">
                            <p><strong>步驟 1：表示積</strong></p>
                            <p>\\[ ${productInput.replace(/\^(\d+)/g, '^{$1}')} = ${formatVisualLatex(visualProduct)} \\]</p>
                            <p>\\[ (${productInput.replace(/\^(\d+)/g, '^{$1}')})^{${exponent}} = (${formatVisualLatex(visualProduct)})^{${exponent}} \\]</p>
                        </div>
                        <div class="step">
                            <p><strong>步驟 2：展開乘方</strong></p>
                            <p>\\[ (${productInput.replace(/\^(\d+)/g, '^{$1}')})^{${exponent}} = \\underset{${absExponent}個${productInput.replace(/\^(\d+)/g, '^{$1}')}} {${step2Line1}} \\]</p>
                            <p>\\[= ${step2Line2} \\]</p>
                            <p>\\[ = ${coefficientLine}${coefficientLine ? ' \\cdot ' : ''}${formatVisualLatex(product.var1 + (product.exp1 === 1 ? '' : `^{${product.exp1}}`)).repeat(absExponent)} ${product.var2 ? `\\cdot ${formatVisualLatex(product.var2 + (product.exp2 === 1 ? '' : `^{${product.exp2}}`)).repeat(absExponent)}` : ''} \\]</p>
                            <p>\\[ = ${formatVisualLatex(visualResult)} \\]</p>
                        </div>
                        <div class="step">
                            <p><strong>步驟 3：指數相乘</strong></p>
                            <p>\\[ (${productInput.replace(/\^(\d+)/g, '^{$1}')})^{${exponent}} = ${product.coefficient === 1 ? '' : formatCoefficient(product.coefficient, exponent)} \\cdot ${product.var1}^{${product.exp1} \\cdot ${exponent}} ${product.var2 ? `\\cdot ${product.var2}^{${product.exp2} \\cdot ${exponent}}` : ''} = ${formatVisualLatex(visualResult)} \\]</p>
                        </div>
                    </div>
                    <p><strong>最終結果</strong>：\\[ ${formatFinalResult(visualResult)} \\]</p>
                `;

                document.getElementById('result-container').innerHTML = steps;
                MathJax.typesetPromise().catch(err => console.error('MathJax typesetting error:', err));
            } catch (e) {
                alert(e.message || '輸入格式不正確，請檢查積或外指數格式！');
                console.error(e);
            }
        }
    </script>
</body>
</html>