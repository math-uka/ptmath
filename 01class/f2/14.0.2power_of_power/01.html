<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>冪的乘方工具與教學</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --primary-color: #1e88e5;
            --secondary-color: #43a047;
            --accent-color: #e53935;
            --light-gray: #f5f5f5;
            --dark-gray: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: var(--dark-gray);
            background-color: #fafafa;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
        }

        h1, h2, h3 {
            color: var(--primary-color);
        }

        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 30px;
        }

        .input-container {
            margin: 20px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        input {
            padding: 12px;
            flex: 1;
            min-width: 200px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }

        button {
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #1565c0;
        }

        .result-container {
            margin-top: 20px;
            padding: 20px;
            background-color: var(--light-gray);
            border-radius: 6px;
            font-size: 1.1em;
        }

        .step-container {
            margin: 20px 0;
            padding: 15px;
            background-color: #e3f2fd;
            border-left: 4px solid var(--primary-color);
            border-radius: 4px;
        }

        .step {
            margin-bottom: 15px;
        }

        .step-number {
            display: inline-block;
            width: 28px;
            height: 28px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 28px;
            margin-right: 10px;
            font-weight: bold;
        }

        .example {
            background-color: var(--light-gray);
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
        }

        footer {
            margin-top: 40px;
            text-align: center;
            font-size: 0.9em;
            color: #777;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .preview-container {
            margin: 20px 0;
            padding: 15px;
            background-color: var(--light-gray);
            border-radius: 6px;
            text-align: center;
            font-size: 1.2em;
        }

        .exercise-container {
            margin: 20px 0;
        }

        .exercise {
            margin-bottom: 20px;
        }

        .exercise p {
            margin: 10px 0;
        }

        .answer {
            display: none;
            padding: 10px;
            background-color: #e3f2fd;
            border-radius: 4px;
            margin-top: 10px;
        }

        .answer-button {
            background-color: var(--secondary-color);
        }

        .answer-button:hover {
            background-color: #2e7d32;
        }
    </style>
</head>
<body>
    <header>
        <h1>冪的乘方互動學習工具</h1>
        <p>通過直觀的步驟展示和互動計算器，輕鬆掌握冪的乘方的核心原理！</p>
        <p>輸入一個冪及其次方（如 \( a^3 \) 和 \( 5 \)，即可查看逐步計算過程與最終結果。</p>
    </header>

    <div class="card">
        <h2>冪的乘方計算器</h2>
        <div class="input-container">
            <input type="text" id="base" value="a^3" placeholder="例如: a^3 或 -a^3 或 (ab)^3 或 (-a)^3 或 2a^23">
            <span style="font-size: 1.5em;">^</span>
            <input type="text" id="outerExponent" value="5" placeholder="例如: 5">
            <button onclick="calculatePowerExponentiation()">計算結果</button>
        </div>
        <div class="preview-container">
            <h3>當前運算</h3>
            <div id="preview">\[ (a^3)^5 \]</div>
        </div>
        <div id="result-container" class="result-container"></div>
    </div>

    <div class="card">
        <h2>冪的乘方教學</h2>
        <p>冪的乘方是代數中的基本運算，遵循指數相乘的規則。以下是詳細步驟：</p>

        <div class="step">
            <h3><span class="step-number">1</span>理解冪的含義</h3>
            <p>冪表示一個底數連續乘以自身的次數。底數可以是單個變數、多項式或帶負號的表達式。例如：</p>
            <p class="example">\( a^3 = a \cdot a \cdot a \)</p>
            <p class="example">\( -a^3 = -(a \cdot a \cdot a) \)</p>
            <p class="example">\( (ab)^3 = (ab) \cdot (ab) \cdot (ab) \)</p>
            <p class="example">\( (-a)^3 = (-a) \cdot (-a) \cdot (-a) \)</p>
            <p>其中 \( a \)、\( (ab) \) 或 \( (-a) \) 是底數，\( 3 \) 是指數。注意：\( -a^3 \) 表示負係數 \(-1\) 乘以 \( a^3 \)，而 \( (-a)^3 \) 表示底數為 \(-a\)。</p>
        </div>

        <div class="step">
            <h3><span class="step-number">2</span>計算步驟</h3>
            <p>以 \( (a^2)^3 \) 為例，計算過程如下：</p>
            <ul>
                <li>表示形式：\( (a^2)^3 = a^2 \cdot a^2 \cdot a^2 \)</li>
                <li>展開：\( a^2 \cdot a^2 \cdot a^2 = (a \cdot a) \cdot (a \cdot a) \cdot (a \cdot a) \)</li>
                <li>合併：\( = a \cdot a \cdot a \cdot a \cdot a \cdot a \)</li>
                <li>最終結果：\( = a^6 \)</li>
            </ul>
        </div>

        <div class="step">
            <h3><span class="step-number">3</span>冪的乘方規則</h3>
            <p>當一個冪被乘方時，內外指數相乘，底數不變，係數的次方單獨計算：</p>
            <p class="example">\( (c \cdot x^m)^n = c^n \cdot x^{m \cdot n} \)</p>
            <p>例如：\( (-a^3)^5 = (-1)^5 \cdot a^{3 \cdot 5} = -a^{15} \)</p>
            <p>或：\( ((ab)^3)^2 = (ab)^{3 \cdot 2} = (ab)^6 \)</p>
            <p>或：\( ((-a)^3)^4 = (-a)^{3 \cdot 4} = (-a)^{12} \)</p>
        </div>

        <div class="step">
            <h3><span class="step-number">4</span>常見錯誤與注意事項</h3>
            <ul>
                <li><strong>指數相乘而非相加</strong>：錯誤：\( (a^3)^5 = a^{3+5} \)，正確：\( a^{3 \cdot 5} = a^{15} \)</li>
                <li><strong>負號的處理</strong>：\( -a^3 \) 表示 \(-1 \cdot a^3\)，而 \( (-a)^3 \) 表示底數 \(-a\) 的三次方：\( (-a)^3 = -a^3 \)，但 \( (-a^3)^2 = (-1)^2 \cdot a^{3 \cdot 2} = a^6 \)，而 \( ((-a)^3)^2 = (-a)^{3 \cdot 2} = (-a)^6 \)</li>
                <li><strong>括號的重要性</strong>：\( (a^3)^5 \) 與 \( a^3 \cdot a^5 \) 不同，前者是冪的乘方，後者是同底數冪乘法</li>
            </ul>
        </div>
    </div>

    <div class="card">
        <h2>隨堂練習</h2>
        <p>請計算以下冪的乘方的結果，點擊「顯示答案」按鈕查看正確答案。</p>
        <div class="exercise-container">
            <div class="exercise">
                <p>1. \( (a^3)^4 \)</p>
                <button class="answer-button" onclick="toggleAnswer('answer1')">顯示答案</button>
                <div id="answer1" class="answer">\[ (a^3)^4 = a^{12} \]</div>
            </div>
            <div class="exercise">
                <p>2. \( ((ab)^2)^3 \)</p>
                <button class="answer-button" onclick="toggleAnswer('answer2')">顯示答案</button>
                <div id="answer2" class="answer">\[ ((ab)^2)^3 = (ab)^6 \]</div>
            </div>
            <div class="exercise">
                <p>3. \( (-2a^5)^2 \)</p>
                <button class="answer-button" onclick="toggleAnswer('answer3')">顯示答案</button>
                <div id="answer3" class="answer">\[ (-2a^5)^2 = 4a^{10} \]</div>
            </div>
            <div class="exercise">
                <p>4. \( (10^3)^4 \)</p>
                <button class="answer-button" onclick="toggleAnswer('answer4')">顯示答案</button>
                <div id="answer4" class="answer">\[ (10^3)^4 = 10^{12} \]</div>
            </div>
            <div class="exercise">
                <p>5. \( ((-a)^4)^2 \)</p>
                <button class="answer-button" onclick="toggleAnswer('answer5')">顯示答案</button>
                <div id="answer5" class="answer">\[ ((-a)^4)^2 = (-a)^8 \]</div>
            </div>
        </div>
    </div>

    <footer>
        <p>© ukawai</p>
    </footer>

    <script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
            return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
            if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
                try {
                    var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                    var firstSheetName = workbook.SheetNames[0];
                    var worksheet = workbook.Sheets[firstSheetName];
                    var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                    var filteredData = jsonData.filter(row => row.some(filledCell));
                    var headerRowIndex = filteredData.findIndex((row, index) =>
                        row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                    );
                    if (headerRowIndex === -1 || headerRowIndex > 25) {
                        headerRowIndex = 0;
                    }
                    var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
                    csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                    return csv;
                } catch (e) {
                    console.error(e);
                    return "";
                }
            }
            return gk_fileData[filename] || "";
        }

        // Disable right-click context menu
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            alert('右鍵功能已被禁用！');
        });

        // Disable F12 key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I')) {
                e.preventDefault();
                alert('開發者工具已被禁用！');
            }
        });

        // Toggle answer visibility
        function toggleAnswer(id) {
            let answer = document.getElementById(id);
            if (answer.style.display === 'block') {
                answer.style.display = 'none';
            } else {
                answer.style.display = 'block';
                MathJax.typesetPromise().catch(err => console.error('MathJax typesetting error:', err));
            }
        }

        // Real-time preview update
        function updatePreview() {
            let base = document.getElementById('base').value || 'a^3';
            let outerExponent = document.getElementById('outerExponent').value || '5';
            // Ensure multi-digit exponents are wrapped in braces for MathJax
            base = base.replace(/\^(\d+)/g, '^{$1}');
            let preview = `\\[ (${base})^{${outerExponent}} \\]`;
            document.getElementById('preview').innerHTML = preview;
            MathJax.typesetPromise().catch(err => console.error('MathJax typesetting error:', err));
        }

        // Add input event listeners for real-time updates
        document.getElementById('base').addEventListener('input', updatePreview);
        document.getElementById('outerExponent').addEventListener('input', updatePreview);

        // Initial preview render
        window.onload = updatePreview;

        function parsePower(term) {
            term = term.replace(/\s/g, '');
            // Match: optional coefficient (number or -), base (variable, number, or parenthesized expression), optional exponent
            let match = term.match(/^(?:(-\d+|\d+|-))?(\([a-zA-Z]+(?:\^\d+)?[a-zA-Z]*(?:\^\d+)?\)|[a-zA-Z]|\d+)(?:\^(-?\d+))?$/);
            if (!match) {
                throw new Error('請輸入有效冪格式，例如 a^13、-a^3、2a^23、-2a^2、(-a)^3、10^3、(ab)^3、-(ab)、(a^2b)^3、(-a^2bc^3)^2');
            }
            let coefficient = match[1] === '-' ? -1 : (match[1] ? parseInt(match[1]) : 1);
            let base = match[2];
            let exponent = match[3] ? parseInt(match[3]) : 1;
            return { coefficient, base, exponent };
        }

        function visualizePower(base, exponent) {
            if (exponent === 0) return '1';
            if (exponent < 0) return `\\frac{1}{${base}}`.repeat(-exponent);
            return base.repeat(exponent);
        }

        function formatVisualLatex(str) {
            let terms = str.match(/-(?:\([a-zA-Z]+(?:\^\d+)?[a-zA-Z]*(?:\^\d+)?\)|(?:\([a-zA-Z]\)|[a-zA-Z]|\d+)(?!\w))|(?:\([a-zA-Z]+(?:\^\d+)?[a-zA-Z]*(?:\^\d+)?\)|(?:\([a-zA-Z]\)|[a-zA-Z]|\d+))|\\frac{1}{-(?:\([a-zA-Z]+(?:\^\d+)?[a-zA-Z]*(?:\^\d+)?\)|(?:\([a-zA-Z]\)|[a-zA-Z]|\d+))}|\\frac{1}{(?:\([a-zA-Z]+(?:\^\d+)?[a-zA-Z]*(?:\^\d+)?\)|(?:\([a-zA-Z]\)|[a-zA-Z]|\d+))}/g) || [str];
            if (terms.length <= 1) return str;
            return terms.join(' \\cdot ').replace(/ \\cdot $/, '');
        }

        function calculatePowerExponentiation() {
            let baseInput = document.getElementById('base').value;
            let outerExponentInput = document.getElementById('outerExponent').value;
            if (!baseInput || !outerExponentInput) {
                alert('請輸入冪和外指數！');
                return;
            }

            try {
                let power = parsePower(baseInput);
                let outerExponent = parseInt(outerExponentInput);
                if (isNaN(outerExponent)) {
                    throw new Error('外指數必須是整數！');
                }

                let coefficient = power.coefficient;
                let base = power.base;
                let innerExponent = power.exponent;
                let finalExponent = innerExponent * outerExponent;
                let visualBase = visualizePower(base, innerExponent);
                let visualResult = visualizePower(base, finalExponent);
                let absOuterExponent = Math.abs(outerExponent);
                let absFinalExponent = Math.abs(finalExponent);

                // Prepare display strings
                let coefficientStr = coefficient === 1 ? '' : (coefficient === -1 ? '-' : coefficient);
                let inputDisplay = coefficient !== 1 ? `${coefficient}${baseInput.replace(/^(?:-\d+|\d+|-)/, '')}` : baseInput;
                // Ensure multi-digit exponents are wrapped in braces for LaTeX
                let latexBase = base.replace(/\^(\d+)/g, '^{$1}');
                let latexInputDisplay = inputDisplay.replace(/\^(\d+)/g, '^{$1}');
                let finalCoefficient = coefficient ** outerExponent;
                let finalCoefficientStr = finalCoefficient === 1 ? '' : (finalCoefficient === -1 ? '-' : finalCoefficient);
                let latexFinalResult = finalCoefficientStr + latexBase;
                if (finalExponent !== 1) {
                    latexFinalResult += `^{${finalExponent}}`;
                }

                // Generate expansion string based on outer exponent and coefficient
                let expansionStr = '';
                let expansionVisualStr = '';
                let expansionCoefficient = coefficientStr === '-' ? '(-1)' : coefficientStr;
                let visualBaseWithCoefficient = expansionCoefficient ? `${expansionCoefficient} ${formatVisualLatex(visualBase)}` : formatVisualLatex(visualBase);
                let displayTerm = coefficient < 0 ? `(${latexInputDisplay})` : latexInputDisplay;
                let visualDisplayTerm = coefficient < 0 ? `(${visualBaseWithCoefficient})` : visualBaseWithCoefficient;
                if (absOuterExponent <= 5) {
                    expansionStr = Array(absOuterExponent).fill(displayTerm).join(' \\cdot ');
                    expansionVisualStr = Array(absOuterExponent).fill(visualDisplayTerm).join(' \\cdot ');
                } else {
                    expansionStr = `${displayTerm} \\cdot ${displayTerm} \\cdot \\ldots \\cdot ${displayTerm}`;
                    expansionVisualStr = `${visualDisplayTerm} \\cdot ${visualDisplayTerm} \\cdot \\ldots \\cdot ${visualDisplayTerm}`;
                }

                let steps = `
                    <div class="step-container">
                        <h3>計算過程</h3>
                        <div class="step">
                            <p><strong>步驟 1：表示冪</strong></p>
                            <p>\\[ ${latexInputDisplay} = ${visualBaseWithCoefficient} \\]</p>
                            <p>\\[ (${latexInputDisplay})^{${outerExponent}} = (${visualBaseWithCoefficient})^{${outerExponent}} \\]</p>
                        </div>
                        <div class="step">
                            <p><strong>步驟 2：展開乘方</strong></p>
                            <p>\\[ (${latexInputDisplay})^{${outerExponent}} = \\underset{${absOuterExponent}個${displayTerm}}{${expansionStr}} \\]</p>
                            <p>\\[ = \\underset{${absOuterExponent}個${visualDisplayTerm}}{${expansionVisualStr}} \\]</p>
                            <p>\\[ = \\underset{${absFinalExponent}個${latexBase}}{${finalCoefficientStr}${formatVisualLatex(visualResult)}} \\]</p>
                        </div>
                    </div>
                    <p><strong>最終結果</strong>：\\[ ${latexFinalResult} \\]</p>
                `;

                document.getElementById('result-container').innerHTML = steps;
                MathJax.typesetPromise().catch(err => console.error('MathJax typesetting error:', err));
            } catch (e) {
                alert(e.message || '輸入格式不正確，請檢查冪或外指數格式！');
                console.error(e);
            }
        }
    </script>
</body>
</html>